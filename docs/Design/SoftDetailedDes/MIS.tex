\documentclass[12pt, titlepage]{article}

\usepackage{amsmath, mathtools}

\usepackage[round]{natbib}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{colortbl}
\usepackage{xr}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{xfrac}
\usepackage{tabularx}
\usepackage{float}
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage[section]{placeins}
\usepackage{caption}
\usepackage{fullpage}

\hypersetup{
bookmarks=true,     % show bookmarks bar?
colorlinks=true,       % false: boxed links; true: colored links
linkcolor=red,          % color of internal links (change box color with linkbordercolor)
citecolor=blue,      % color of links to bibliography
filecolor=magenta,  % color of file links
urlcolor=cyan          % color of external links
}

\usepackage{array}

\externaldocument{../../SRS/SRS}

\input{../../Comments}
\input{../../Common}

\begin{document}

\title{Module Interface Specification for \progname{}}

\author{\authname}

\date{\today}

\maketitle

\pagenumbering{roman}

\section{Revision History}

\begin{tabularx}{\textwidth}{p{3cm}p{2cm}X}
\toprule {\bf Date} & {\bf Version} & {\bf Notes}\\
\midrule
16/01/23 & 1.0 & Abi started M4, M5, M7\\
17/01/23  & 1.1 & Abi finished M4, M5, M7, Intro\\
18/01/23 & 1.2 & Anthony finished M2,3,6,8\\
\bottomrule
\end{tabularx}

~\newpage

\section{Symbols, Abbreviations and Acronyms}

See SRS Documentation \href{https://github.com/NevoAbigail/Capstone/blob/main/docs/SRS/SRS.pdf}{here}.

%\wss{Also add any additional symbols, abbreviations or acronyms}

\newpage

\tableofcontents

\newpage

\pagenumbering{arabic}

\section{Introduction}

The following document details the Module Interface Specifications for
SmartLock, a bluetooth-driven bike lock brough to you by the Locked \& Loaded team. The SmartLock allows users to unlock their bike remotely using Bluetooth. 

%\wss{Fill in your project name and description}

Complementary documents include the System Requirement Specifications
and Module Guide.  The full documentation and implementation can be
found in \href{https://github.com/NevoAbigail/Capstone}{the GitHub repo}. % \wss{provide the url for your repo}

Note that not every module documented in the Module Guide has a corresponding section in this document, as an MIS was only completed for every software module, and not those modules with a hardware implementation. 

\section{Notation}

\progname \ uses functions, which
are defined by the data types of their inputs and outputs. Local functions are
described by giving their type signature followed by their specification.

\section{Module Decomposition}

The following table is taken directly from the Module Guide document for this project.

\begin{table}[h!]
\centering
\begin{tabular}{p{0.3\textwidth} p{0.6\textwidth}}
\toprule
\textbf{Level 1} & \textbf{Level 2}\\
\midrule

{Hardware-Hiding Module} & ~ \\
\midrule

\multirow{7}{0.3\textwidth}{Behaviour-Hiding Module} & Input Parameters Module \\
& Output Parameters Module \\
& Engage Status Signal Module \\
& Wireless Signal Connection Module \\
& Battery Status Module \\
& Location Module \\ 
& Lock Frame Module \\
\midrule

\multirow{3}{0.3\textwidth}{Software Decision Module} & Load Power Signal Module \\
& Battery Module \\
& Electromagnet Module \\
& Locking Mechanism Module \\
\bottomrule

\end{tabular}
\caption{Module Hierarchy}
\label{TblMH}
\end{table}

\newpage
~\newpage





\section{MIS of M2} \label{InputParameters} 

\subsection{Input Parameter Module}

As described in the \href{https://github.com/NevoAbigail/Capstone/blob/main/docs/Design/SoftArchitecture/MG.pdf}{MG document}, the Input Parameter Module (M2) is responsible for receiving input from the user. Parameters include input to unlock the bike as well as request the current geo location of the user. 

\subsection{Uses}


\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

N/A

\subsection{Semantics}

\subsubsection{State Variables}

\begin{itemize}
\item storedLocation, type: Location object, package: location
\end{itemize}


\subsubsection{Environment Variables}


\begin{itemize}
\item engageButton, type: Floating Action Button, Screen Interface
\item locationButton, type: Floating Action Button, Screen Interface
\end{itemize}


\subsubsection{Assumptions}
None.

\subsubsection{Access Routine Semantics}

None.

\subsubsection{Local Functions}

None.


\section{MIS of M3} \label{OutputParameters} 

\subsection{Output Parameter Module}

As described in the \href{https://github.com/NevoAbigail/Capstone/blob/main/docs/Design/SoftArchitecture/MG.pdf}{MG document}, the Output Parameter Module (M3) is responsible for displaying the battery status, location, and the engaged status signal. In this module, there are submodules to store the current location requested by the user. 

\subsection{Uses}


\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

N/A

\subsection{Semantics}

\subsubsection{State Variables}

\begin{itemize}
\item storedLocation, type: Location object, package: location
\end{itemize}


\subsubsection{Environment Variables}

None.


\subsubsection{Assumptions}

None.

\subsubsection{Access Routine Semantics}

\noindent loadScreen():
This routine oversees the layout and UserInterface architecture. It ensures all buttons, labels, and images fall within the constraints of any mobile device. 
\begin{itemize}
\item inputs: engageButton, locationButton
\item transition: none
\item output: none
\item exception: none
\end{itemize}

\subsubsection{Local Functions}

None.





\section{MIS of M4} \label{EngageStatus} 

\subsection{Engage Status Signal Module}

As described in the \href{https://github.com/NevoAbigail/Capstone/blob/main/docs/Design/SoftArchitecture/MG.pdf}{MG document}, the Engage Status Signal Module (M4) is responsible for trasmitting the engagement status of the lock from the Arduino to the mobile app. If the status reads "engaged", then the Arduino is not currently sending a high signal to the transistor, and the electromagnet remains off, meaning the latch in the locking mechanism is shut. Therefore, if the pin is in the lock, it will not be able to move. If the status reads "disengaged", then the Arduino is currently writing a high signal to the transistor, and the electromagnet is on, opening the latch in the locking mechanism, and allowing the pin to move freely (in or out of the lock). 

\subsection{Uses}


\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

N/A

\subsection{Semantics}

\subsubsection{State Variables}

None. 

\subsubsection{Environment Variables}

%\wss{This section is not necessary for all modules.  Its purpose is to capture
%  when the module has external interaction with the environment, such as for a
%  device driver, screen interface, keyboard, file, etc.}

\begin{itemize}
\item e\_BTService, type: BLEService
\item e\_DisengageCharacteristic; type: BLEByteCharacteristic
\end{itemize}

Note that the environment variables are the same as that of M5, as an established Bluetooth connection is a prerequisite of M4, and these variables must still be used to keep the BlueTooth connection active. 

\subsubsection{Assumptions}

%\wss{Try to minimize assumptions and anticipate programmer errors via
%  exceptions, but for practical purposes assumptions are sometimes appropriate.}

This module assumes there is a successful BlueTooth connection established between the Arduino and the mobile app. 

\subsubsection{Access Routine Semantics}


\noindent readEngagementStatus():

This access routine will be implemented on the mobile app, and will read the current value of  e\_DisengageCharacteristic.

\begin{itemize}
\item inputs
\item transition: %\wss{if appropriate} 
\item output: e\_DisengageCharacteristic
\item exception:  
\end{itemize}

\subsubsection{Local Functions}

None.


\section{MIS of M5 \label{WirelessSignalConnection}} 

\subsection{Wireless Signal Connection Module}

As described in the \href{https://github.com/NevoAbigail/Capstone/blob/main/docs/Design/SoftArchitecture/MG.pdf}{MG document}, the Wireless Signal Connection Module (M5) is responsible for establishing a BlueTooth connection between the Arduino and the mobile app.

\subsection{Uses}


\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

N/A

\subsection{Semantics}

\subsubsection{State Variables}

None.

\subsubsection{Environment Variables}

\begin{itemize}
\item e\_BTService, type: BLEService
\item e\_DisengageCharacteristic; type: BLEByteCharacteristic
\end{itemize}


\subsubsection{Assumptions}

\begin{itemize}
\item Arduino is powered on.
\end{itemize}

\subsubsection{Access Routine Semantics}

\noindent BTconnect():

This routine creates a BlueTooth connection between the mobile app and the Arduino so that they can send and receive signals from each other. This routine will need an implementation both for the Arduino, and for the mobile app, where the Arduino will act as the peripheral device, and the mobile app will act as the central device. 

\begin{itemize} 
\item inputs: none
\item transition: loadPower(), the access routine of M7, upon successful connection
\item output: none
\item exception: connection status will appear on the mobile app. Therefore, the user will be aware of the connection status, whether that be successful or unsuccessful. 
\end{itemize}

\subsubsection{Local Functions}

None.


\section{MIS of M6} \label{BatteryStatus} 

\subsection{Battery Status Module}

As described in the \href{https://github.com/NevoAbigail/Capstone/blob/main/docs/Design/SoftArchitecture/MG.pdf}{MG document}, the Battery Status Module (M6) is responsible for calculating the battery status. In this module, there are submodules to calculate the amount of battery left.

\subsection{Uses}


\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

N/A

\subsection{Semantics}

\subsubsection{State Variables}

None.


\subsubsection{Environment Variables}

None.


\subsubsection{Assumptions}

None.

\subsubsection{Access Routine Semantics}

\noindent getBatteryStatus():
This routine gets the battery amount remaining.
\begin{itemize}
\item inputs: batteryCalculator()
\item transition: none
\item output: none
\item exception: none
\end{itemize}

\subsubsection{Local Functions}

\noindent batteryCalculator():
This function is used to calculate the amount of battery remaining. The output is used in the getBatteryStatus function.




\section{MIS of M7  \label{LoadPowerSignal}}

\subsection{Load Power Signal Module}

As described in the \href{https://github.com/NevoAbigail/Capstone/blob/main/docs/Design/SoftArchitecture/MG.pdf}{MG document}, the Load Power Signal Module (M7) is responsible for sending a high power/ON signal to the transistor once a disengage signal is written to the Arduino. An ON signal to the transistor acts as a switch ON, and will power the electromagnet to disengage the lock. 

\subsection{Uses}

\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

N/A

\subsection{Semantics}

\subsubsection{State Variables}

None.

\subsubsection{Environment Variables}

\begin{itemize}
\item e\_BTService, type: BLEService
\item e\_DisengageCharacteristic; type: BLEByteCharacteristic
\end{itemize}

Note that the environment variables are the same as that of M5, as an established Bluetooth connection is a prerequisite of M7, and these variables must still be used to keep the BlueTooth connection active. 

\subsubsection{Assumptions}

Assumes M5 has been successfully completed; there is an established BlueTooth connection between the Arduino and the mobile app.

\subsubsection{Access Routine Semantics}

\noindent loadPower():

This access routine is responsible for recieving the signal to disengage the lock, and then, should this signal be received, sending a HIGH signal to the transistor. This will be implemented on the Arduino. 

\begin{itemize}
\item inputs: e\_DisengageCharacteristic
\item transition: none 
\item output: if e\_DisengageCharacteristic has a nonzero value (i.e., the disengage button on the app GUI is pressed), write a HIGH signal to the Arduino pin wired to the corresponding transistor terminal for five seconds (enough time to pull the pin out of the lock, or in other words, unlock your bike). 
\item exception: none 
\end{itemize}

\subsubsection{Local Functions}

None.




\section{MIS of M8} \label{Location} 

\subsection{Location Module}

As described in the \href{https://github.com/NevoAbigail/Capstone/blob/main/docs/Design/SoftArchitecture/MG.pdf}{MG document}, the Location Module (M8) is responsible for gathering the location data requested by the user. In this module, there are submodules to store the current location requested by the user.

\subsection{Uses}


\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

N/A

\subsection{Semantics}

\subsubsection{State Variables}

\begin{itemize}
\item storedLocation, type: Location object, package: location
\end{itemize}


\subsubsection{Environment Variables}

None.


\subsubsection{Assumptions}

None.

\subsubsection{Access Routine Semantics}

\noindent updateLocation():
This routine writes to the local json file to store the last location requested by the user.
\begin{itemize}
\item inputs: locationButton()
\item transition: none
\item output: none
\item exception: none
\end{itemize}

\noindent getLocation():
This routine reads from the local json file to get the last location requested by the user
\begin{itemize}
\item inputs: none
\item transition: none
\item output: storedLocation
\item exception: none
\end{itemize}

\subsubsection{Local Functions}

None.


\newpage

\bibliographystyle {plainnat}
\bibliography {../../../refs/References}

%\newpage

%\section{Appendix} \label{Appendix}

%\wss{Extra information if required}

\end{document}